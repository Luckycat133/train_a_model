# 训练模块 (train_model.py) 更新日志

[English](../en/for_train_model.md) | [中文](./for_train_model.md)

---

## [v0.8.6] - 2025-04-10
### 测试代码增强
- 创建全面的测试脚本(test_train_model.py)用于模型训练功能测试
- 实现不同配置下数据集加载的性能基准测试
- 添加内存和时间格式化等工具函数的测试
- 开发训练统计图表绘制功能的测试
- 实现性能优化的数据收集功能

## [v0.8.5] - 2025-03-21
### 全局日志输出优化
- **全系统日志格式统一**
  - 统一修改所有模块的控制台日志，移除时间戳与日志级别前缀
  - 标准化文件日志格式，保留完整的时间、级别和模块信息
  - 优化日志文件命名和存储结构
- **日志处理机制改进**
  - 分离控制台和文件日志的格式设置，提升用户体验
  - 优化日志记录器配置方法，防止日志重复输出
  - 增强不同模块间的日志一致性

## [v0.8.4] - 2025-03-21
### 日志系统优化
- **日志输出精简**
  - 移除控制台输出中的时间戳和日志级别，减少视觉干扰
  - 保留文件日志中的完整时间和级别信息，便于问题排查
  - 重构日志初始化逻辑，彻底解决日志重复问题
- **信息分组与格式优化**
  - 调整配置信息输出格式，按功能分组展示
  - 优化分隔符和装饰元素，保持简洁性
  - 统一日志接口，简化内部实现
- **性能优化**
  - 减少日志IO操作频率，提高训练性能
  - 优化日志记录器配置，避免资源浪费
  - 解决os模块的引用冲突问题

## [v0.8.3] - 2025-03-20
### 用户体验改进
- **进度条优化**
  - 重新设计进度条显示方式，使其更加简洁流畅
  - 减少进度条刷新频率，优化终端输出体验
  - 简化进度信息，只保留关键指标
  - 统一所有进度条样式，提高一致性
- **终止处理机制增强**
  - 改进强制终止功能，确保Ctrl+C能够可靠地停止训练
  - 实现终止前的自动保存机制，防止数据丢失
  - 添加10秒超时强制退出功能，避免卡死情况
  - 优化中断时的用户提示信息，提高可理解性

## [v0.8.2] - 2025-03-18
### 界面与交互优化
- **界面简化**
  - 重新设计日志输出格式，移除冗余信息
  - 简化进度条显示，提供更清晰的训练状态
  - 移除过多的装饰性分隔线和彩色输出
  - 统一命令行界面风格，与其他模块保持一致
- **Bug修复**
  - 修复夜间模式时间检测错误，解决datetime模块引用问题
  - 优化日志记录系统，避免重复日志输出
  - 简化消息输出格式，提高可读性
  - 统一消息显示风格

## [v0.8.1] - 2025-03-17
### 紧急修复
- **关键Bug修复**
  - 修复路径处理不一致问题，统一使用Path对象
  - 解决词汇表大小获取错误，导致模型初始化失败
  - 修复日志目录创建逻辑，确保正确保存到logs/train_model下
  - 解决终止信号处理不及时的问题
- **代码质量提升**
  - 消除重复函数和冗余代码
  - 统一异常处理和错误日志格式
  - 改进内存管理策略
  - 优化检查点文件命名和管理

### 终止处理机制增强
- **响应式终止**
  - 添加批次内终止响应，无需等待整个epoch完成
  - 实现分层终止确认机制，确保数据完整性
  - 添加紧急情况下的用户交互确认
  - 优化检查点保存逻辑，确保快速保存当前状态

### 用户界面改进
- **进度显示增强**
  - 全面美化训练和测试进度条，提供更直观的视觉反馈
  - 添加批次处理时间和预计剩余时间显示
  - 使用彩色输出增强关键信息可识别性
  - 优化进度条格式，提供更精确的完成时间估计
- **时间格式化**
  - 新增智能时间格式化函数，自动调整显示单位（秒/分钟/小时）
  - 统一各处时间显示格式，提高一致性
  - 改进耗时统计和展示方式

## [v0.8.0] - 2025-03-16
### 稳定性和兼容性增强
- **数据加载机制重构**
  - 解决DataLoader工作进程意外退出的关键问题
  - 实现单进程数据加载模式 (num_workers=0)，提高稳定性
  - 优化大规模数据集的批处理和内存管理
  - 添加训练样本数量检查和警告机制
- **分词器集成增强**
  - 实现多层次词汇表大小检测方法，解决词汇表获取错误
  - 添加三种备选分词器加载策略，提高分词器加载成功率
  - 将默认词汇表大小从50000调整为30000，更符合当前数据规模
  - 添加分词器文件自动检测机制，支持从多个位置加载备份
- **Apple Silicon完全适配**
  - 针对MPS后端优化训练配置，提高性能和稳定性
  - 自动检测并适应MPS不支持的特性（如混合精度训练）
  - 优化内存使用模式，减少内存峰值占用

### 系统架构优化
- **自动化日志系统**
  - 重构日志处理机制，确保日志自动保存到正确位置
  - 实现按日期和训练版本分类的日志目录结构
  - 增强日志内容的可读性和信息完整性
  - 添加训练关键节点的高亮显示和标记
- **健壮的错误处理**
  - 完善异常捕获和处理流程，提供更详细的错误信息
  - 添加训练文件存在性检查，避免不必要的处理尝试
  - 实现智能的内存压力检测和预警机制
  - 优化中断处理，确保意外中断时正确保存模型状态

### 交互体验改进
- **命令行界面优化**
  - 简化参数设置，优化默认值配置
  - 添加更详细的帮助信息和参数说明
  - 优化进度显示，提供更准确的估计完成时间
  - 训练样本创建过程增加实时进度反馈
- **环境检测与适配**
  - 自动检测Python和PyTorch版本，确保兼容性
  - 智能识别可用的加速设备并优化配置
  - 自动创建必要的目录结构和文件路径
  - 提供清晰的系统状态和环境信息报告

## [v0.7.1] - 2025-03-15
### 稳定性修复
- **紧急修复**
  - 解决在使用MPS后端时的随机崩溃问题
  - 修复GPU内存泄漏问题
  - 解决训练中断时检查点保存不完整的问题
- **小型改进**
  - 优化日志输出格式，提高可读性
  - 添加更多训练状态信息
  - 改进内存压力检测准确性

## [v0.7.0] - 2025-03-14
### 新功能
- **自动保存与恢复机制**
  - 实现训练中断后自动恢复最近检查点功能
  - 添加定期自动保存检查点（默认每轮一次）
  - 智能检测最新可用检查点
  - 支持显式指定恢复检查点
- **夜间低功耗模式**
  - 在指定时间段自动降低资源使用
  - 实现自适应批次大小调整
  - 优化GPU利用率，降低功耗
  - 提供可配置的时间窗口设置

### 性能优化
- **混合精度训练**
  - 支持FP16混合精度计算，提升训练速度
  - 实现动态损失缩放
  - 智能检测设备支持能力
  - 提供精度与速度的平衡选项
- **梯度累积支持**
  - 实现梯度累积功能，支持更大批次训练
  - 优化内存使用，突破显存限制
  - 支持可配置的累积步数
  - 改进权重更新策略

### 架构改进
- **模型架构优化**
  - 改进Transformer层初始化方法
  - 优化注意力计算机制
  - 实现更高效的位置编码
  - 支持更大的上下文窗口（512 tokens）
- **学习率策略增强**
  - 添加余弦退火学习率调度
  - 实现学习率预热功能
  - 支持自适应学习率调整
  - 优化优化器参数配置

## [v0.6.0] - 2025-03-12
### 特性增强
- **评估指标扩展**
  - 添加困惑度（Perplexity）计算
  - 实现训练/验证损失实时对比
  - 添加模型大小和速度指标
  - 支持自定义评估方法

### 兼容性改进
- **多平台支持增强**
  - 添加Apple Silicon (M1/M2) 原生支持
  - 改进CPU训练模式效率
  - 优化CUDA设备检测和使用
  - 跨平台训练结果一致性保证

## [v0.5.0] - 2025-03-10
### 功能完善
- **训练流程优化**
  - 实现检查点保存和加载
  - 添加早停机制
  - 训练状态可视化
  - 多GPU训练支持

## [v0.4.0] - 2025-03-20
### 架构升级
- **模型结构革新**
  - 从LSTM架构迁移至Transformer架构
  - 添加多头注意力机制
  - 实现位置编码
  - 设计可扩展的模块化结构
- **训练框架重构**
  - 优化批处理流程
  - 添加梯度裁剪功能
  - 支持更大的上下文窗口
  - 改进学习率调度策略

## [v0.3.0] - 2025-03-05
### 功能拓展
- **新增日志与可视化**
  - 实现详细的训练日志记录
  - 添加训练过程可视化图表
  - 集成TensorBoard支持
  - 训练指标实时监控
- **数据处理增强**
  - 实现动态批次大小调整
  - 添加数据增强技术
  - 优化数据加载流程
  - 支持多种输入格式

## [v0.2.0] - 2025-03-01
### 性能优化
- **资源管理改进**
  - 添加夜间模式自动切换
  - 实现资源使用限制功能
  - 优化内存分配策略
  - 提高大型数据集处理能力
- **训练效率提升**
  - 批量处理优化
  - 实现数据预取机制
  - 添加多线程数据加载
  - 改进损失计算方法

## [v0.1.0] - 2025-02-25
### 初始版本
- **基础功能实现**
  - LSTM模型基本架构
  - 简单数据加载与处理
  - 基础训练循环
  - 模型保存与加载
- **基本配置选项**
  - 命令行参数解析
  - 简单日志记录
  - 基础错误处理
  - 训练参数配置
